<%- include('../partials/header') %>

<div class="page-header">
    <h1 class="page-title">
        <span class="icon">‚úÖ</span>
        Steam Activations
    </h1>
</div>

<div class="card" style="margin-bottom: 1rem;">
    <form method="GET" action="/dashboard/steam/activations" style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap;">
        <div class="form-group" style="flex: 1; min-width: 200px; margin: 0;">
            <label class="form-label">Search by Username</label>
            <input type="text" name="search" class="form-control" placeholder="Enter username..." value="<%= typeof search !== 'undefined' ? search : '' %>">
        </div>
        <button type="submit" class="btn btn-primary">üîç Search</button>
        <% if (typeof search !== 'undefined' && search) { %>
        <a href="/dashboard/steam/activations" class="btn btn-secondary">Clear</a>
        <% } %>
    </form>
</div>

<div class="card">
    <% if (activations && activations.length > 0) { %>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>User</th>
                    <th>Game</th>
                    <th>Account</th>
                    <th>Ticket</th>
                    <th>Activated</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% activations.forEach(a => { %>
                <tr>
                    <td><%= a.username || a.user_id || '-' %></td>
                    <td><%= a.game_name || '-' %></td>
                    <td>
                        <% if (a.account_name || a.account_number) { %>
                        <span class="badge badge-secondary">
                            <%= a.account_number ? '#' + a.account_number + ' - ' : '' %><%= a.account_name || '-' %>
                        </span>
                        <% } else { %>
                        -
                        <% } %>
                    </td>
                    <td class="font-mono"><%= a.ticket_id || '-' %></td>
                    <td class="text-muted font-mono"><%= formatDate(a.activated_at || a.created_at) %></td>
                    <td>
                        <% if (a.ticket_id) { %>
                        <a href="/dashboard/transcripts/<%= a.ticket_id %>" class="btn btn-secondary btn-sm" title="View Transcript">üëÅ View</a>
                        <% } else { %>
                        -
                        <% } %>
                    </td>
                </tr>
                <% }); %>
            </tbody>
        </table>
    </div>
    <% } else { %>
    <div class="empty-state">
        <div class="icon">‚úÖ</div>
        <p>No activations found<%= typeof search !== 'undefined' && search ? ' for "' + search + '"' : '' %>.</p>
    </div>
    <% } %>
</div>

<%- include('../partials/footer') %>
