<%- include('_layout-start') %>

<div class="content-header">
    <h2>ðŸ“‹ Audit Logs</h2>
    <span class="badge badge-ea">Admin Only</span>
</div>

<div class="content-body">
    <div class="card">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>User</th>
                        <th>Action</th>
                        <th>Category</th>
                        <th>Target</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (!logs || logs.length === 0) { %>
                    <tr><td colspan="6" style="text-align:center; color:#888;">No audit logs</td></tr>
                    <% } %>
                    <% (logs || []).forEach(log => { %>
                    <tr>
                        <td style="white-space:nowrap;"><%= new Date(log.created_at).toLocaleString() %></td>
                        <td><%= log.username || 'System' %></td>
                        <td>
                            <span class="badge badge-<%= 
                                log.action === 'create' ? 'success' : 
                                log.action === 'delete' ? 'failed' : 
                                log.action === 'update' || log.action === 'edit' ? 'pending' : 
                                'closed' 
                            %>"><%= log.action %></span>
                        </td>
                        <td>
                            <span class="badge badge-<%= log.category %>"><%= log.category %></span>
                        </td>
                        <td>
                            <% if (log.target_type) { %>
                            <code><%= log.target_type %><%= log.target_id ? '#' + log.target_id : '' %></code>
                            <% if (log.target_name) { %><br><small><%= log.target_name %></small><% } %>
                            <% } else { %>
                            -
                            <% } %>
                        </td>
                        <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis;"><%= log.details || '-' %></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<%- include('_layout-end') %>
